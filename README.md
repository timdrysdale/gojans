# gojans
A Go (golang) client adapter for [Janssen (Gluu) auth server](https://github.com/JanssenProject/home)

![alt text][status]

## Background

Janssen is a Linux Foundation project providing a cloud-native identity and access management (IAM) platform, originating from the [Gluu](https://www.gluu.org/). ```Janssen``` is the sort of open-source project that should attract your support - a big proper thing made independent from its commercial creator so it can take on a life of its own, with its own ecosystem.  

Alternatives include [Keycloak](https://www.keycloak.org/), and its [golang adapter](https:github.com/Nerzal/gocloak). If, like me, you started there, you might want to read [this](https://www.gluu.org/blog/keycloak-is-the-next-centos/) bearing in mind it is from the CEO and founder of Gluu. Nonetheless, the point is well made, because [RedHat did indeed drop Centos](https://arstechnica.com/gadgets/2020/12/centos-shifts-from-red-hat-unbranded-to-red-hat-beta/). Anyway, so far as I can tell, the Gluu server has better (accurate!) documention (including openAPI3.0 spec), a bunch of certifications, and it includes a more complete implementation of UMA2.0 amongst other features.

Thus Janssen project is perhaps a better bet if you are starting an open-source project which requires its own IAM server, and worried about what might happen to the viability of keycloak should it follow the same path as CENTOS (not to mention all the things it already does better). Meanwhile, one of the downsides is the cost of having a play around - I'm running the full community edition Gluu server 4.2 is on a t3.xlarge with 50GB of disk space just to rule out some initial instabilities that might have been caused by low memory when running on a smaller instance. YMMV.

### Using golang with the Janssen project

So far as I can tell, there is no existing SDK for golang.  This repo is an attempt to create a client adapter for the Janssen project, to replicate what [gocloak](https:github.com/Nerzal/gocloak) does for keycloak.  ```Gocloak``` was hand-crafted, whereas there is an openAPI spec for the Janssen project. Why make a separate repo then?

It turns out that the conversion from the existing openAPI3.0 spec to good golang code is not automatic - some adjustments to the spec are needed to get the types right, there is more than one choice of converter, and code-gen, and it would be helpful to include tests down the line. So having the code in a common repo will save others repeating the work of figuring that out. 

Hence ```gojans```, the ```gocloak``` for ```jans``` (the Janssen project). ```gojans``` is NOT an official part of the ```janssen`` project, and is not endorsed by them etc. It's just something I need ... and offered to you in the hope it helps you out too.

### Future maintenance

Simple - don't mess with autogenerated code in ```client``` and ```models``` - unless it somehow needs it.

### Limitations (for now)

(as of Dec 2020) I'm on a deadline for the next phase of own project which needs IAM. I was just starting to get going on using ```keycloak``` by contributing to ```gocloak``` when the news about CENTOS dropped (both in the news, and literal senses). I've decided to switch horses, as I'm not yet in the middle of the stream as it were. This is to avoid predictable refactoring efforts coming early in the project lifecycle. Therefore, implementation modifications beyond the generated code, and testing, will initially focus only what I need for my project. PR super welcome though.

## Organisation

The project is split up so that the ```swagger``` files can be kept separately for ease of inspection (and generating new boiler-plate for patch generation purposes), while the generated (and potentially modified) code is found in ```src```. Any demos can go in their own folder, in ```internal``` depending on how the demo is done (e.g. with ```curl```).

```
.
├── internal
│   └── curl
├── img
├── pkg
│   └── jansAuth
│       ├── client
│       └── models
└── api
    └── openapi-spec
```


  
## Curl

Trying out some commands with curl helps check the modified spec is ok (or not!) and gain familiarity with the API. You can do this as follows.

export some common variables

```
export host=jans.your.host
export client_id=p9l9adf...
export client_secret=425jlk345....
```

Make sure the client has the ```client_credentials``` grant type enabled iun the openID Connect Client configuration. It takes a minute or two to take effect from when it the configuration is updated. For details of the request, see the [token endpoint details](https://gluu.org/docs/gluu-server/4.2/api-guide/openid-connect-api/).

To see the full details of the request which is sent, you can add ```--trace-ascii /dev/stdout``` e.g.

```
curl --trace-ascii /dev/stdout -X  POST \
	 -H "Content-Type: application/x-www-form-urlencoded" \
    -d "grant_type=client_credentials&client_id=${client_id}&client_secret=${client_secret}"\
    "https://${host}/oxauth/restv1/token" \
```

To store the token in a variable, use ```jq``` to parse the response

```
client_token=$(curl -s -X POST\
	 -H "Content-Type: application/x-www-form-urlencoded" \
    -d "grant_type=client_credentials&client_id=${client_id}&client_secret=${client_secret}"\
    "https://${host}/oxauth/restv1/token" \
	| jq -r '.access_token')
echo $client_token	
```

Query... how quickly will permissions added to the server be accessible?!
  
gluu ser


## Mocking

This can be done automatically with [apisprout](https://github.com/danielgtaylor/apisprout) although it would require the examples to be set usefully.

[status]: https://img.shields.io/badge/status-concept-yellow "concept status"
